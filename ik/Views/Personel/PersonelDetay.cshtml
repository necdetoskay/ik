@using ik.Models

@{
    ViewBag.Title = "PersonelDetay";
}
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
@section styles{
    <style>
        #feedback {
            font-size: 1.4em;
        }

        #liste .ui-selecting {
            background: #FECA40;
        }

        #liste .ui-selected {
            background: #F39814;
            color: white;
        }

        #liste {
            list-style-type: none;
            margin: 0;
            padding: 0;
            width: 450px;
        }

            #liste li {
                margin: 3px;
                padding: 1px;
                float: left;
                width: 80px;
                height: 100px;
                /*font-size: 4em;
            text-align: center;*/
            }
    </style>
}





<div id="body" class="row">
    <div class="col-lg-6">
        <div class="col-lg-6">
            <select id="personel"></select>
        </div>
        <div class="col-lg-6">
            <img id="personelthumb" />
            <button id="browseimg" style="display: block">Seç</button>
        </div>
    </div>
    <div class="col-lg-6">

    </div>
    <div id="resimler">

    </div>
    <div class="col-md-12">
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#ozluk">Özlük Bilgileri</a></li>
            <li><a data-toggle="tab" href="#egitim">Eğitim Durumu</a></li>
            <li><a data-toggle="tab" href="#giriscikis">Ay Giriş Çıkış</a></li>
            <li><a data-toggle="tab" href="#izinrapor">Son İzinler/ Raporlar</a></li>
        </ul>

    </div>
    <div class="col-lg-12">


        <div class="tab-content">
            <div id="giriscikis" class="tab-pane fade in active">
                <input type="button" id="giriscikisyukle" value="Yükle" />
                <div class="content"></div>
            </div>
            <div id="izinrapor" class="tab-pane fade">
                <input type="button" id="izinraporyukle" value="Yükle" />
                <div class="content"></div>
                @*<p>
                        @Html.Partial("_Loading")

                    </p>*@
            </div>
            <div id="ozluk" class="tab-pane fade">
                <input type="button" id="ozlukyukle" value="Yükle" />
                <div class="content">
                    @*<div class="container">
                        <div class="row">
                            <form role="form">
                                <div class="form-group col-xs-10 col-sm-4 col-md-4 col-lg-4">
                                    <label for="exampleInputEmail1">Email address</label>
                                    <input type="email" class="form-control" id="exampleInputEmail1" placeholder="Enter email">
                                </div>
                                <div class="form-group col-xs-10 col-sm-4 col-md-4 col-lg-4">
                                    <label for="exampleInputEmail1">Name</label>
                                    <input type="text" class="form-control" id="exampleInputEmail1" placeholder="Enter Name">
                                </div>
                                <div class="clearfix"></div>
                                <div class="form-group col-xs-10 col-sm-4 col-md-4 col-lg-4">
                                    <label for="exampleInputPassword1">Password</label>
                                    <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
                                </div>
                                <div class="form-group col-xs-10 col-sm-4 col-md-4 col-lg-4">
                                    <label for="exampleInputPassword1">Confirm Password</label>
                                    <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Confirm Password">
                                </div>
                                <div class="clearfix"></div>
                                <div class="form-group col-xs-10 col-sm-10 col-md-4 col-lg-4">
                                        <label for="exampleInputFile">File input</label>
                                        <input type="file" id="exampleInputFile">
                                        <p class="help-block">Example block-level help text here.</p>
                                    </div>
                                <div class="col-xs-10 col-sm-10 col-md-4 col-lg-4">
                                        <label>
                                            <input type="radio"> Check me out<input type="radio"> Check me out<input type="radio"> Check me out
                                        </label>
                                    </div>
                                    <div class="clearfix"></div
                                <div class="col-xs-10 col-sm-4 col-md-4 col-lg-4">
                                    <button type="submit" class="btn btn-default">Submit</button>
                                </div>
                            </form>
                            <div class="clearfix"></div>
                            <br /><br />
                        </div>
                    </div>
                </div>*@
            </div>
            <div id="egitim" class="tab-pane fade">
                <input type="button" id="egitimyukle" value="Yükle" />
                <div class="content"></div>
                @*<p>
                        @Html.Partial("_Loading")

                    </p>*@
            </div>
        </div>

    </div>

</div>

@section scripts{

    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
    <script src="~/Scripts/bootstrap-dialog.js"></script>

    <script type="text/javascript">
        $(function () {
            var ROOT = '@Url.Content("~")';
            var btn = $('#browseimg');

            $('#izinraporyukle').on('click', function () {
                var selected = $("#personel option:selected");
                $.ajax({
                    url: '@Url.Action("IzinveRaporlar","Pdks")',
                    type: 'GET',
                    data: { ikID: selected.val() },
                    success: function (result) {
                        if (result.Success === true) {
                            console.log(result.Data);
                            //tablo hazırla
                            $('#izinrapor').find('.loading').addClass('hidden');
                            var content = $('#izinrapor').find('.content');
                            content.empty();
                            content.append('<table class="table"><thead><tr><td>İzin Tipi</td><td>Başlangıç</td><td>Bitiş</td><td>Açıklama</td></tr></thead><tbody id="izinraporbody"></tbody></table>');
                            var gcbody = $('#izinraporbody');
                            $.each(result.Data, function (i, item) {
                                gcbody.append('<tr><td>' + item.izintip + '</td><td>' + item.Baslangic + '</td><td>' + item.Bitis + '</td><td>' + item.aciklama + '</td></tr>');
                            });
                        }
                    }
                });
            });
            $('#ozlukyukle').on('click', function () {
                var selected = $("#personel option:selected");
                $.ajax({
                    url: '@Url.Action("Sicil","Personel")',
                    type: 'GET',
                    data: { ikID: selected.val() },
                    success: function (result) {
                        $(this).find('.content').html(result);
                    }
                });
            });

            $('#giriscikisyukle').on('click', function () {
                var selected = $("#personel option:selected");
                $.ajax({
                    url: '@Url.Action("AylikHareketler","Pdks")',
                    type: 'GET',
                    data: { id: selected.val() },
                    success: function (result) {
                        if (result.Success === true) {
                            //console.log(result.Data);
                            //tablo hazırla
                            $('#giriscikis').find('.loading').addClass('hidden');
                            var content = $('#giriscikis').find('.content');
                            content.empty();
                            content.append('<table class="table"><thead><tr><td>Tarih</td><td>Giriş Saati</td><td>Çıkış Saati</td></tr></thead><tbody id="giriscikisbody"></tbody></table>');
                            var gcbody = $('#giriscikisbody');
                            $.each(result.Data, function (i, item) {
                                gcbody.append('<tr><td>' + item.Tarih + '</td><td>' + item.Giriş + '</td><td>' + item.Çıkış + '</td></tr>');
                            });
                        }
                    }
                });//izinrapor
            });


            btn.on('click', function () {

                //eğer selectlist seçili değilse  çık
                var val = $('#personel').val();
                if (val < 0) return;

                var liste = $('<div style="height:500px; overflow:scroll" class="row" <ol id="liste"></ol></div>');

                $.ajax({
                    url: '@Url.Action("_PersonelResimleri","Media")',
                    type: 'GET',
                    success: function (result) {
                        $.each(result, function (i, item) {
                            liste.append('<li class="ui-state-default"><img thumb="' + item.imageSrc + '" src="' + ROOT + item.imageSrc + '" title="' + item.text + '" height="80" width="80"><span style="text-overflow: ellipsis;display: block;overflow: hidden;" title="' + item.text + '">' + item.text + '</span></li>');
                        });
                        liste.selectable({
                            selected: function (event, ui) {
                                $(ui.selected).addClass('ui-selected').siblings().removeClass('ui-selected');
                            }
                        });


                        // $('#resimler').append(liste);
                        //text = f.Name,
                        //imageSrc = Url.Content("~//Content//Media//pers_resim//" + f.Name)
                        BootstrapDialog.show({
                            title: 'Say-hello dialog',
                            message: liste,
                            data: {
                                'id': val
                            },
                            buttons: [
                                {
                                    label: 'Kaydet',
                                    action: function (dialogItself) {
                                        var thumb = $('#liste .ui-selected').find('img');//.attr("src");
                                        if (thumb.length > 0) {
                                            var id = dialogItself.getData('id');
                                            var resim = thumb.attr("src");

                                            $.ajax({
                                                url: '@Url.Action("_PersonelResimEkle")',
                                                type: 'POST',
                                                data: {
                                                    id: id,
                                                    thumb: thumb.attr('thumb')
                                                },
                                                success: function (result) {
                                                    if (result === true) {
                                                        $('#personelthumb').attr('src', resim);
                                                        $('#personelthumb').attr('thumb', thumb.attr('thumb'));
                                                    }

                                                }
                                            });
                                        }
                                        dialogItself.close();
                                    }
                                }
                            ]
                        });
                    }
                });



            });




            var pers = $('#personel');
            $.ajax({
                url: '@Url.Action("_SelectList","Personel")',
                type: 'GET',
                success: function (result) {
                    pers.empty();
                    pers.append('<option value="-1">Personel Seçinizi</option>');
                    $.each(result, function (i, item) {
                        pers.append('<option thumb="' + item.Thumb + '" value="' + item.Value + '">' + item.Text + '</option>');
                    });
                }
            });
            pers.on('change', (function () {
                var selected = $("#personel option:selected");
                var thumb = selected.attr("thumb");
                $('.content').each(function () {
                    $(this).empty();
                });



                $('#personelthumb').attr("thumb", thumb);
                $('#personelthumb').attr("src", ROOT + thumb);

                $('.loading').removeClass("hidden");
                //yükleme tamamlanınca loading ikonunu gizle







            }));



            @*$.ajax({
                url:'@Url.Action("_PersonelResimleri","Media")',
                type: 'GET',
                success:function(result) {
                    $('#myDropdown').ddslick({
                        data: result,
                        width: 400,
                        height:600,
                        selectText: "Personel Resim Seçiniz",
                        imagePosition: "right",
                        onSelected: function (selectedData) {
                            console.log(selectedData);
                            //callback function: do something with selectedData;
                        }
                    });
                }
            });

            $.ajax({
                url: '@Url.Action("_PersonelWithThums", "Personel")',
                type: 'GET',
                success: function (result) {
                    $('#personel').ddslick({
                        data: result,width: 600,
                        height: 600,
                        selectText: "Personel Resim Seçiniz",
                        imagePosition: "left",
                        onSelected: function (selectedData) {
                            console.log(selectedData);
                            //callback function: do something with selectedData;
                        }
                    });
                }
            });*@
        })
    </script>
}

